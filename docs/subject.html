<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Brian Clozel">
<title>Spring Boot Hands-on Lab</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Spring Boot Hands-on Lab</h1>
<div class="details">
<span id="author" class="author">Brian Clozel</span><br>
<span id="email" class="email"><a href="mailto:bclozel@pivotal.io">bclozel@pivotal.io</a></span><br>
<br><span id="revremark">Creative Commons BY-NC-SA 4.0 International License</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#bootstrap-hol-application">Bootstrap the Hands-on Lab application</a></li>
<li><a href="#controller-using-asciidoctorj">Create an Asciidoc converter endpoint</a></li>
<li><a href="#production-ready-actuator">Production ready features with Spring Boot Actuator</a></li>
<li><a href="#persisting-notes-datastore">Persisting Notes to a datastore</a></li>
<li><a href="#">Wiring everything together</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>During this Hands-on Lab, we&#8217;ll create a simple notepad application that persists Asciidoc notes in a SQL database.
You should have the previous Spring Boot Lab documentation handy, this could give you useful code samples.
A section of this lab also requires a working version of your previous lab with Vert.x, but we won&#8217;t need it right away.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
During the whole lab, you&#8217;ll find the Spring Boot
<a href="http://docs.spring.io/spring-boot/docs/1.5.2.RELEASE/reference/htmlsingle/">reference documentation</a> /
<a href="http://docs.spring.io/spring-boot/docs/1.5.2.RELEASE/api/">javadoc API</a>
and the Spring Framework
<a href="http://docs.spring.io/spring-framework/docs/4.3.7.RELEASE/spring-framework-reference/html/">reference documentation</a> /
<a href="http://docs.spring.io/spring-framework/docs/4.3.7.RELEASE/javadoc-api/">javadoc API</a>
quite useful.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bootstrap-hol-application"><a class="anchor" href="#bootstrap-hol-application"></a>Bootstrap the Hands-on Lab application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the <a href="http://start.spring.io">Spring Initializr</a> to create your new application.</p>
</div>
<div class="paragraph">
<p>For this lab, we&#8217;ll select the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We&#8217;ll generate a <strong>Gradle</strong> project with Spring Boot <strong>1.5.2.RELEASE</strong></p>
</li>
<li>
<p>Our group Id <code>fr.insalyon.tc</code> and artifact Id <code>spring-boot-hol</code></p>
</li>
<li>
<p>In the dependencies search box, select <code>Web</code>, <code>DevTools</code> and <code>Actuator</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Click on "Generate", unzip the file somewhere, open it in your favorite IDE.</p>
</div>
<div class="paragraph">
<p>In the <code>spring-boot-intro</code> folder, your <code>build.gradle</code> file should look like this:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">buildscript {
  ext {
    springBootVersion = '1.5.2.RELEASE'
  }
  repositories {
    mavenCentral()
  }
  dependencies {
    classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
  }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'org.springframework.boot'

jar {
  baseName = 'spring-boot-hol'
  version = '0.0.1-SNAPSHOT'
}

sourceCompatibility = 1.8

repositories {
  mavenCentral()
}

dependencies {
  compile('org.springframework.boot:spring-boot-starter-web') <i class="conum" data-value="1"></i><b>(1)</b>
  runtime('org.springframework.boot:spring-boot-devtools') <i class="conum" data-value="2"></i><b>(2)</b>
  compile('org.springframework.boot:spring-boot-starter-actuator') <i class="conum" data-value="3"></i><b>(3)</b>
  testCompile('org.springframework.boot:spring-boot-starter-test') <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This starter brings the necessary dependencies for building a Spring MVC application</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Devtools will improve your development experience</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Actuator brings production ready features to your application (more on that later)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This starter brings useful dependencies for writing tests for your application</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you&#8217;ve got an IDE installed, you can import it as a Java Gradle application and run the
<code>SpringBootHolApplication</code> class directly from the IDE.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can open a new console and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ ./gradlew --continuous bootRun <i class="conum" data-value="1"></i><b>(1)</b>

[...]
INFO 9740 --- [  restartedMain] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)
INFO 9740 --- [  restartedMain] f.i.tc.SpringBootHolApplication      : Started SpringBootIntroApplication in 0.684 seconds
[...]
&gt; Building 80% &gt; :bootRun <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>--continuous</code> gradle option will restart the server when we recompile the project</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the build gets "stuck" at 80%, but the server is actually started and ready to accept connections</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A new Tomcat server instance has started and our application is running on port <code>8080</code>.
Using curl or a browser, we can send an HTTP request to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ curl http://localhost:8080/ <i class="conum" data-value="1"></i><b>(1)</b>
{"timestamp":1488035893342,"status":404,"error":"Not Found","message":"No message available","path":"/"}% <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a server is running on port 8080 (port chosen by default, but you can configure that)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>since we&#8217;ve defined no web endpoint, Spring answers with a custom HTTP 404 error message</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
During the whole Hands-on lab, you can extensively use the previous Spring Boot Lab for code samples
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controller-using-asciidoctorj"><a class="anchor" href="#controller-using-asciidoctorj"></a>Create an Asciidoc converter endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/">Asciidoctor</a> is a markup language, and we&#8217;ll
use it as the main format driving our notepad application. Notes should be written in Asciidoc and
users should read them as HTML documents.</p>
</div>
<div class="paragraph">
<p>First, we&#8217;ll add the relevant dependencies to our build:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">compile('org.asciidoctor:asciidoctorj:1.5.4.1')
compile('org.jruby:jruby-complete:9.1.8.0')</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, copy this interface, we&#8217;ll use it to convert asciidoc documents to HTML:</p>
</div>
<div class="listingblock">
<div class="title">src/main/fr/insalyon/tc/asciidoc/AsciidocConverter.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package fr.insalyon.tc.asciidoc;

public interface AsciidocConverter {

  /**
   * Convert the asciidoc markup given as an argument
   * to a complete HTML document (headers, style, etc).
   * @param asciidocSource asciidoc markup
   * @return a complete HTML document
   */
  String convertToHtmlDocument(String asciidocSource);

  /**
   * Convert the asciidoc markup given as an argument
   * to an HTML snippet, which means it does not
   * contain headers, style, footer, etc.
   * @param asciidocSource asciidoc markup
   * @return an HTML snippet
   */
  String convertToHtmlSnippet(String asciidocSource);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now create an <code>AsciidoctorService</code> that implements this interface; this service should be a
Spring service (and annotated as such).</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a code sample that demonstrates how to use the Asciidoctor library we&#8217;ve added to our
classpath. Don&#8217;t copy that file, just cherry-pick code from it to implement <code>AsciidoctorService</code>:</p>
</div>
<div class="listingblock">
<div class="title">Sample code, don&#8217;t copy this file into your project</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package fr.insalyon.tc.asciidoc;

import org.asciidoctor.Asciidoctor;
import org.asciidoctor.Attributes;
import org.asciidoctor.OptionsBuilder;
import org.asciidoctor.SafeMode;

public class AsciidoctorSample {

  private final Asciidoctor asciidoctor;

  private final OptionsBuilder options;

  public static void main(String[] args) {
    // global setup
    Asciidoctor asciidoctor = Asciidoctor.Factory.create();
    Attributes attributes = new Attributes();
    attributes.setAttribute("source-highlighter", "prettify");
    attributes.setAttribute("idprefix", "");
    attributes.setAttribute("idseparator", "-");
    attributes.setAnchors(true);
    OptionsBuilder options = OptionsBuilder.options().safe(SafeMode.SAFE).attributes(attributes);

    String asciidocSource = "== Spring Boot Hands on Lab";

    // create a full HTML document, with header and footer
    String fullHtmlDocument = asciidoctor.convert(asciidocSource, options.headerFooter(true));

    // just create an HTML snippet, without header/footer
    String htmlSnippet = asciidoctor.convert(asciidocSource, options);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your job is to create a <code>DocConverterController</code>, which should behave like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">curl -X POST http://localhost:8081/asciidoc -H "Content-Type:text/asciidoc" -d "== Spring Boot\n"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are a few tips:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>you should use the <code>AsciidoctorService</code> component to convert asciidoc markup to HTML</p>
</li>
<li>
<p>you can use the <a href="https://docs.spring.io/spring-framework/docs/4.3.7.RELEASE/javadoc-api/">Spring Framework Javadoc</a>
and use the following annotations <code>@RestController</code>, <code>@PostMapping</code> (look at the "produces" and "consumes" attributes).</p>
</li>
<li>
<p>in order to get the request body as a controller method argument, use <code>@RequestBody</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use this test class to verify that your implementation is correct; running the tests
is as easy as <code>/gradlew test</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/fr/insalyon/tc/asciidoc/DocConverterControllerTests.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package fr.insalyon.tc.asciidoc;

import fr.insalyon.tc.asciidoc.AsciidoctorService;
import fr.insalyon.tc.asciidoc.DocConverterController;
import org.junit.Test;
import org.junit.runner.RunWith;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

import static org.mockito.BDDMockito.any;
import static org.mockito.BDDMockito.given;
import static org.mockito.BDDMockito.never;
import static org.mockito.BDDMockito.verify;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@RunWith(SpringRunner.class)
@WebMvcTest(DocConverterController.class) <i class="conum" data-value="1"></i><b>(1)</b>
public class DocConverterControllerTests {

  @Autowired
  private MockMvc mockMvc; <i class="conum" data-value="2"></i><b>(2)</b>

  @MockBean
  private AsciidoctorService asciidoctorService; <i class="conum" data-value="3"></i><b>(3)</b>

  @Test
  public void shouldConvertAsciidocToHtml() throws Exception {

    given(this.asciidoctorService.convertToHtmlDocument("== test content"))
        .willReturn("&lt;h2&gt;Test Content&lt;/h2&gt;"); <i class="conum" data-value="4"></i><b>(4)</b>

    this.mockMvc
        .perform(post("/asciidoc")
            .content("== test content")
            .contentType("text/asciidoc")
            .accept(MediaType.TEXT_HTML)) <i class="conum" data-value="5"></i><b>(5)</b>
        .andExpect(status().isOk())
        .andExpect(content().string("&lt;h2&gt;Test Content&lt;/h2&gt;")); <i class="conum" data-value="6"></i><b>(6)</b>
  }

  @Test
  public void shouldNotAcceptPlainText() throws Exception {

    this.mockMvc
        .perform(post("/asciidoc")
            .content("== test content")
            .contentType("text/plain") <i class="conum" data-value="7"></i><b>(7)</b>
            .accept(MediaType.TEXT_HTML))
        .andExpect(status().isUnsupportedMediaType()); <i class="conum" data-value="8"></i><b>(8)</b>
    verify(this.asciidoctorService, never()).convertToHtmlDocument(any()); <i class="conum" data-value="9"></i><b>(9)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is only testing the <code>DocConverterController</code>, without starting the actual HTTP server</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We&#8217;re using <code>MockMvc</code> to emulate the whole HTTP/MVC infrastructure</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Instead of using the real <code>AsciidoctorService</code>, we&#8217;re asking Spring Boot to create and
inject automatically a <a href="https://en.wikipedia.org/wiki/Mock_object">Mock object</a> for us</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We&#8217;re describing here the behavior that the Mock should have in this test case</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The content type of the request body should be "text/asciidoc" and we&#8217;re expecting "text/html" in return</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The Controller should return the expected value</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Trying to send the wrong content type&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>&#8230;&#8203; the server should respond with HTTP 415, unsupported media type</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Check that the Mock has never been called</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-actuator"><a class="anchor" href="#production-ready-actuator"></a>Production ready features with Spring Boot Actuator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once deployed to production, developers often need to add some tooling to their application.
What&#8217;s the health status of my application? What were the latest
HTTP requests received? Can I have some metrics on my application?</p>
</div>
<div class="paragraph">
<p>Those are questions that Actuator might help you answer.</p>
</div>
<div class="paragraph">
<p>First, take a look at the
<a href="http://docs.spring.io/spring-boot/docs/1.5.2.RELEASE/reference/html/production-ready-enabling.html">Spring Boot reference documentation</a>
about Actuator. We&#8217;ve already enabled it by adding its dependency, so you can continue reading about the
<a href="http://docs.spring.io/spring-boot/docs/1.5.2.RELEASE/reference/html/production-ready-endpoints.html">available endpoints</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Note that those endpoints are protected by default, and that you should cofigure in production a proper
authentication mechanism. Here, we&#8217;ll just add <code>management.security.enabled=false</code> to our <code>application.properties</code>
file to disable security on those endpoints.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, look for the following information by just using curl or your browser on your application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get a list of all mappings configured for your application (by you, and Spring Boot)</p>
</li>
<li>
<p>Information about the server hosting the application (available memory, number of CPUs, etc)</p>
</li>
<li>
<p>Get a list of the environment variables and configuration keys for your application</p>
</li>
<li>
<p>Look at the health status of our application; can you explain the content of the JSON response?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring Boot allows you to contribute new information to that <code>"/health"</code> endpoint, by adding
a custom <code>HealthIndicator</code> Bean to the Spring context. Spring Boot will execute its method
to contribute some health status to the global application status.</p>
</div>
<div class="paragraph">
<p>In this case, our application will use in the future the services provided by our Vert.x application.
We&#8217;d like our indicator to check that the instance is actually alive, by issuing a GET request
on the <code>"/"</code> endpoint of this service and that it responds with a HTTP 200 OK status (if you didn&#8217;t
change anything, it should respond with "Yo!").</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the port 8080 is already used by the Vert.x application, you can customize the port of your
SPring Boot application by adding <code>server.port=8081</code> (for example) to your <code>application.properties</code> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, add the following to your <code>SpringBootHolApplication</code> and implement the missing part.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/fr/insalyon/tc/SpringBootHolApplication.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">// import org.springframework.boot.actuate.health.Health;
// import org.springframework.boot.actuate.health.HealthIndicator;
// import org.springframework.context.annotation.Bean;
// import org.springframework.http.ResponseEntity;
// import org.springframework.web.client.RestClientException;
// import org.springframework.web.client.RestTemplate;

@Bean
public HealthIndicator authServiceHealthIndicator() {
  return new HealthIndicator() {
      @Override
      public Health health() {
        // implement this
      }
    };
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://docs.spring.io/spring-boot/docs/1.5.2.RELEASE/reference/html/production-ready-endpoints.html#_writing_custom_healthindicators">
"Writing custom HealthIndicators" section</a>.</p>
</div>
<div class="paragraph">
<p>Your health indicator should use a <code>RestTemplate</code> instance to send this HTTP request and get back a <code>ResponseEntity</code> to check the HTTP
response status. This <a href="https://spring.io/guides/gs/consuming-rest/#_make_the_application_executable">getting started guide</a>
and the <a href="http://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#getForEntity-java.net.URI-java.lang.Class-">
"RestTemplate javadoc"</a> should be useful as well.</p>
</div>
<div class="paragraph">
<p>Your custom health indicator, when queried with <code>/health</code>, should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>answer "UP" if the Vert.x service is running properly</p>
</li>
<li>
<p>anwser "DOWN" if the service returns the wrong HTTP status</p>
</li>
<li>
<p>anwser "DOWN" if the service is not running</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if the service is not running, the <code>RestTemplate</code> will throw a subclass of a <code>RestClientException</code> with all the useful details.
You should catch it and use that exception in the Health response.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once done, and if your remote authentication service is not started, you should get something like this for <code>"/health"</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">{
  "status": "DOWN",
  "authService": {
    "status": "DOWN",
    "error": "org.springframework.web.client.ResourceAccessException: I/O error on GET request for \"http://localhost:8080/\": Connection refused (Connection refused); nested exception is java.net.ConnectException: Connection refused (Connection refused)"
  },
  "diskSpace": {
    "status": "UP",
    "total": 498927140864,
    "free": 276261748736,
    "threshold": 10485760
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persisting-notes-datastore"><a class="anchor" href="#persisting-notes-datastore"></a>Persisting Notes to a datastore</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we&#8217;d like to interact with a data store, for example a SQL database.
We&#8217;re going to use Spring Data for our programming model and "h2" as an in-memory database.</p>
</div>
<div class="paragraph">
<p>You can add the following dependencies to your <code>build.gradle</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">compile('org.springframework.boot:spring-boot-starter-data-jpa')
compile('com.h2database:h2')</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the application.properties files, add the following property to enable the H2 console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-properties" data-lang="properties">spring.h2.console.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now restart your server and with a browser, check out now <code><a href="http://localhost:8080/h2-console" class="bare">http://localhost:8080/h2-console</a></code> .</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Make sure to use the value <code>jdbc:h2:mem:testdb</code> as a connection URL in the "JDBC URL" form field.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is the admin console for our H2 database. You shouldn&#8217;t see any database table, since we haven&#8217;t persisted anything yet.</p>
</div>
<div class="paragraph">
<p>Now create a <code>Note</code> entity class that we will store in our database.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/fr/insalyon/tc/notes/Note.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package fr.insalyon.tc.notes;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
@SuppressWarnings("serial")
public class Note {

  @Id
  @GeneratedValue
  private Long id;

  @Column(nullable = false)
  private String rawContent; <i class="conum" data-value="1"></i><b>(1)</b>

  @Column(nullable = false)
  private String renderedContent; <i class="conum" data-value="2"></i><b>(2)</b>

  @SuppressWarnings("unused")
  private Note() {
  }

  public Note(String rawContent) {
    this.rawContent = rawContent;
  }

  public Long getId() {
    return this.id;
  }

  public void setId(Long id) {
    this.id = id;
  }

  public String getRawContent() {
    return this.rawContent;
  }

  public void setRawContent(String rawContent) {
    this.rawContent = rawContent;
  }

  public String getRenderedContent() {
    return this.renderedContent;
  }

  public void setRenderedContent(String renderedContent) {
    this.renderedContent = renderedContent;
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the raw note content, in asciidoc format</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the raw content, once rendered as HTML by asciidoctor</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This class is annotated with <code>@Column</code>, <code>@Entity</code> and <code>@Id</code>, which helps Spring Data to map
Java objects to an actual database table.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then create the following <code>NoteRepository</code> interface.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/fr/insalyon/tc/notes/NoteRepository.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package fr.insalyon.tc.notes;

import org.springframework.data.jpa.repository.JpaRepository;

public interface NoteRepository extends JpaRepository&lt;Note, Long&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This extends a Spring Data interface, which provides methods such as <code>findOne</code>, <code>save</code> and more.
This repository will handle <code>Note</code> entities, and those are identified by an Id of type <code>Long</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Creating such an interface is enough! At runtime, Spring Data will create an implementation of
that interface for you, and it will be available in the Spring context, so you can inject it in your application.</p>
</div>
<div class="paragraph">
<p>Now copy the following file, which should create at startup an entry in the database for you:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/import.sql</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-sql" data-lang="sql">INSERT INTO NOTE ( RAW_CONTENT, RENDERED_CONTENT ) VALUES  ( '== Some title', '&lt;div class="sect1"&gt;&lt;h2 id="some-title"&gt;&lt;a class="anchor" href="#some-title"&gt;&lt;/a&gt;Some title&lt;/h2&gt;&lt;div class="sectionbody"&gt;&lt;/div&gt;&lt;/div&gt;');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify, using the h2 console on <code><a href="http://localhost:8080/h2-console/" class="bare">http://localhost:8080/h2-console/</a></code>, that this entry is in your database.</p>
</div>
</div>
</div>
<div class="sect1">
<h2>Wiring everything together</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the last step of the Hands-on Lab. We&#8217;ll create a <code>NotesController</code> that returns a existing <code>Note</code>
in JSON format if it&#8217;s in the database, and can also create a new <code>Note</code> in the database if the HTTP client
POSTs data to a particular endpoint.</p>
</div>
<div class="paragraph">
<p>Now create a <code>DocsController</code> that matches the following specification:</p>
</div>
<div class="paragraph">
<p>Sending a GET HTTP request to <code>"/notes/12"</code> should retrieve the <code>Note</code> of Id <code>12</code> and return it in JSON format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ curl localhost:8080/notes/1 -i
HTTP/1.1 200
Content-Type: application/json;charset=UTF-8

{"id":1,"rawContent":"== Some title","renderedContent":"&lt;div class=\"sect1\"&gt;&lt;h2 id=\"some-title\"&gt;&lt;a class=\"anchor\" href=\"#some-title\"&gt;&lt;/a&gt;Some title&lt;/h2&gt;&lt;div class=\"sectionbody\"&gt;&lt;/div&gt;&lt;/div&gt;"}%</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sending a POST HTTP request to <code>"/notes"</code> with an asciidoc body should create a new <code>Note</code>, render its content
using the converter, save it in the database and finally return it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ curl http://localhost:8080/notes -d'== Some title' -H"Content-Type: text/asciidoc" -i
HTTP/1.1 201
Content-Type: application/json;charset=UTF-8

{"id":2,"rawContent":"== Some title","renderedContent":"&lt;div class=\"sect1\"&gt;\n&lt;h2 id=\"some-title\"&gt;&lt;a class=\"anchor\" href=\"#some-title\"&gt;&lt;/a&gt;Some title&lt;/h2&gt;\n&lt;div class=\"sectionbody\"&gt;\n\n&lt;/div&gt;\n&lt;/div&gt;"}%</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
your <code>NotesController</code> will need two components, the <code>AsciidocConverter</code> and the <code>NoteRepository</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
don&#8217;t know how to use <code>NoteRepository</code>? This inherits from <code>CrudRepository</code> which holds all the interesting
methods you&#8217;ll need, see <a href="http://docs.spring.io/spring-data/commons/docs/current/api/index.html?org/springframework/data/repository/CrudRepository.html">its javadoc</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To validate your implementation, you can use the following test and run it with <code>./gradlew test</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/fr/insalyon/tc/notes/DocsControllerTests.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package fr.insalyon.tc.notes;

import fr.insalyon.tc.asciidoc.AsciidocConverter;
import org.junit.Test;
import org.junit.runner.RunWith;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

import static org.mockito.BDDMockito.any;
import static org.mockito.BDDMockito.eq;
import static org.mockito.BDDMockito.given;
import static org.mockito.BDDMockito.times;
import static org.mockito.BDDMockito.verify;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@RunWith(SpringRunner.class)
@WebMvcTest(NotesController.class)
public class NotesControllerTests {

  @Autowired
  private MockMvc mockMvc;

  @MockBean
  private NoteRepository noteRepository;

  @MockBean
  private AsciidocConverter asciidocConverter;

  @Test
  public void testFindOneNote() throws Exception {

    Note note = new Note("== Spring Boot");
    note.setId(1L);
    note.setRenderedContent("&lt;h2&gt;Spring Boot&lt;/h2&gt;");

    given(this.noteRepository.findOne(1L)).willReturn(note);

    this.mockMvc
        .perform(get("/notes/1").accept(MediaType.APPLICATION_JSON))
        .andExpect(status().isOk())
        .andExpect(jsonPath("$.rawContent").value("== Spring Boot"));
  }

  @Test
  public void testCreateNote() throws Exception {

    Note note = new Note("== Spring Boot");
    note.setId(1L);
    note.setRenderedContent("&lt;h2&gt;Spring Boot&lt;/h2&gt;");

    given(this.asciidocConverter.convertToHtmlSnippet("== Spring Boot")).willReturn("&lt;h2&gt;Spring Boot&lt;/h2&gt;");
    given(this.noteRepository.save(any(Note.class))).willReturn(note);

    this.mockMvc
        .perform(post("/notes/")
            .accept(MediaType.APPLICATION_JSON)
            .contentType("text/asciidoc")
            .content("== Spring Boot"))
        .andExpect(status().isCreated())
        .andExpect(jsonPath("$.renderedContent").value("&lt;h2&gt;Spring Boot&lt;/h2&gt;"));

    verify(this.asciidocConverter, times(1)).convertToHtmlSnippet(eq("== Spring Boot"));
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-03-16 00:11:58 CET
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
</body>
</html>